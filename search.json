[{"title":"Deploying PHP and MySQL to Azure [free tier]","url":"/blog/deploying-php-and-mysql-to-azure/","content":"<p>This post will go over the steps of deploying PHP to Azure. This environment should only be used for development/learning purposes only!</p>\n<h2 id=\"Why-use-Azure\">Why use Azure?</h2>\n<p>With PHP being a backbone to small development or just for learning, finding free places to host is huge. Though with that said, many bank on the simplicity of <strong>000webhost</strong> or other free providers. Even though simplicity is great, stability is a major factor. This will guide you on how to install:</p>\n<ul>\n<li>PHP 7.4</li>\n<li>Enabling MySQL and phpMyAdmin</li>\n</ul>\n<p>On a free tier of Azure’s App Service.</p>\n<h2 id=\"Accessing-Azure\">Accessing Azure</h2>\n<p>To access Azure go to: <a href=\"https://portal.azure.com\">portal.azure.com</a>. You will need to sign in via a Microsoft Account.</p>\n<blockquote>\n<p>TIP: If you are a new user to Azure, they may introduce you to the platform.</p>\n</blockquote>\n<h2 id=\"Creating-a-resource-group\">Creating a resource group</h2>\n<p>On the home page of the Azure Portal we can create a new resource by clicking <strong>Create a resource</strong>. This may look different for users with customized home portal pages. This will create a new group to make new resources within.</p>\n<img src=\"azure_create_resource.png\" />\n<h2 id=\"Configure-the-resource-group\">Configure the resource group</h2>\n<p>When creating a new resource group, you can name and change the hosting region it depending on your environment. For example we could name it after a class like done so below:</p>\n<img src=\"azure_name_resource.png\" />\n<p>Then follow the dialog to the <strong>Review + Create</strong> screen. Once you’ve reviewed the name of this resource group you can create it. After the resource is created you can click on it to view the resource group.</p>\n<h2 id=\"Create-a-new-resource\">Create a new resource</h2>\n<p>Now that we have a resource group is created we want to make a new resource. This can be done by clicking the <strong>Add</strong> button near the menu bar as shown below:</p>\n<img src=\"azure_add_to_resource.png\" />\n<h3 id=\"Selecting-a-Web-App\">Selecting a Web App</h3>\n<p>After clicking on the create resource we can select the <strong>Web App</strong> service as shown below. Don’t click on the <em>Quickstarts + Tutorials</em>, that will open documentation!</p>\n<img src=\"azure_add_web_app.png\" />\n<h3 id=\"Creating-the-Web-App\">Creating the Web App</h3>\n<p>This next step will allow us to configure the Web App Service. As we want to use PHP, let’s select the runtime stack to the latest PHP version (7.4 is the latest the Azure currently offers at the time of this post).</p>\n<p>Also give your new Web App Service a name, like for example naming it after yourself and a class you may be in.</p>\n<p>Lastly make sure this is running in Windows, published via Code, and is the selected region is the same as the resource group. Also make sure this is running on the Free F1 tier of Azure. Once this is all complete click <strong>Next</strong>.</p>\n<img src=\"azure_setup_service.png\" />\n<h3 id=\"Disable-Monitoring\">Disable Monitoring</h3>\n<p>Because this is a free tier monitoring isn’t available. Then let’s <strong>Review + create</strong> this new app service by clicking the blue button at the bottom.</p>\n<img src=\"azure_disable_monitoring.png\" />\n<h3 id=\"Deployment-Progress\">Deployment Progress</h3>\n<p>Once the you’ve reviewed and created this new Web App Service, the next screen will show the deployment progress. This progress can take a moment, just wait for a check mark under the deployment details.</p>\n<img src=\"azure_wait_for_deploy.png\" />\n<p>Once the new app service is deployed successfully, you can click into it. This will show a dashboard with:</p>\n<ul>\n<li>URL to the PHP site.</li>\n<li>Charts about the inbound and outbound data traffic.</li>\n</ul>\n<img src=\"azure_app_overview.png\" />\n<h2 id=\"Enabling-MySQL\">Enabling MySQL</h2>\n<p>To enable MySQL, you can scroll down to the Setting category (or you can use the Search feature with Ctrl+/) and its called <strong>MySQL In App</strong> and click to manage it. Then click the <strong>MySQL In App</strong> toggle button to enable it. It may take a minute to actually enable in the background.</p>\n<img src=\"azure_enable_mysql.png\" />\n<h3 id=\"Using-PHPMyAdmin\">Using PHPMyAdmin</h3>\n<p>By default PHPMyAdmin shouldn’t need to be installed, although through the App Service you can go <strong>Extensions -&gt; PHPMyAdmin</strong> you can do this if you’d like. Keep in mind that to access PHP my admin the URL goes as follows:</p>\n<blockquote>\n<p>https://<strong>[site name here]</strong>.scm.azurewebsites.net/phpmyadmin/</p>\n</blockquote>\n<p>So for this tutorial the URL would be:</p>\n<blockquote>\n<p><a href=\"https://brendanfuller-cis355.scm.azurewebsites.net/phpmyadmin/\">https://brendanfuller-cis355.scm.azurewebsites.net/phpmyadmin/</a></p>\n</blockquote>\n<img src=\"azure_phpmyadmin.png\" />\n<h4 id=\"Troubleshooting-PHPMyAdmin-Failed-to-Connect\">Troubleshooting: PHPMyAdmin Failed to Connect?</h4>\n<p>If you attempt to access the PHPMyAdmin while your “PHP Web Service” is in sleep mode you might come across this error:</p>\n<blockquote>\n<p>mysqli_real_connect(): (HY000/2002): An attempt was made to access a socket in a way forbidden by its access permissions.</p>\n</blockquote>\n<p>You just need to boot the Web App Service again. This can be performed by going to a new tab and just viewing the site. This will boot the application up and PHPMyAdmin will work again though make sure to refresh it.</p>\n<h2 id=\"Using-FTP\">Using FTP</h2>\n<p>The last part to actually uploading PHP code is where to do so. Now if you want to use git or other methods of code deployment, go for it. Though for most common people FTP, or in this case SFTP (Secure File Transfer Protocol) will be used.</p>\n<p>Accessing FTP is as simple as going to the App Service, and in the Deployment Category click <strong>Deployment Center</strong>. Do not click the one that says classic! This will take a second or more to load.</p>\n<img src=\"azure_deploy_ftp.png\" />\n<h3 id=\"FTP-Credentials\">FTP Credentials</h3>\n<p>Next we can click the <strong>FTP credentials</strong> tab to view the credentials, like shown below:</p>\n<img src=\"azure_ftp_creds.png\" />\n<h3 id=\"Connect-to-FTP\">Connect to FTP</h3>\n<p>Next we would like to connect to FTP using a FTP client. <a href=\"https://filezilla-project.org/\">FileZilla</a> or <a href=\"https://winscp.net/eng/download.php\">WinSCP</a> are very well made clients that can do SFTP (which is something that we need).</p>\n<p>Now to connect with these credentials, for example in FileZilla we would use the follow connection setup:</p>\n<img src=\"ftp_connect.png\" />\n<h4 id=\"File-Tree\">File Tree</h4>\n<p>Once connected to FTP, at least in FileZilla you will see a file tree. The <strong>wwwroot</strong> is where the main folder/directory where the code is located.</p>\n<img src=\"ftp_file_tree.png\" />\n<p>Now you will see a file list for the <strong>wwwroot</strong> directory. Any files in here will be accessible via the URL of the site.</p>\n<img src=\"ftp_www_list.png\" />\n<h2 id=\"PHP-and-MySQL-Credentials\">PHP and MySQL Credentials</h2>\n<p>Lastly you may want to use the MySQL server in some PHP code. The fastest way to do this is to include the file below (call it like <strong>db.php</strong>). The comments in the file explain the parameters and usage:</p>\n<pre><code class=\"language-php\">&lt;?php \n    /*\n    Get Azure local MySQL database connection information \n\n    Original Author: https://medium.com/@niravmadariya/azure-mysql-in-app-for-app-services-bcea588108b6\n\n    Array Output:\n        $CONN[&quot;database&quot;] = Database\n        $CONN[&quot;data_source&quot;] = Server Address (server's ip address, which will be local)\n        $CONN[&quot;user_id&quot;] = Username\n        $CONN[&quot;passsword&quot;] = Password\n\n    Usage:\n    \n    //In some db.php file\n    &lt;?php\n        //Include the azure data into the db.php file\n        include_once(&quot;./azure.php&quot;);\n        $CONN = getAzureMySQLInfo() //Now get the connection information\n        //ORM or MySqli connection can be made here with the new connection info...\n    ?&gt;\n\n    */\n    function getAzureMySQLInfo() &#123;\n        $CONNECTION_ENV = getenv(&quot;MYSQLCONNSTR_localdb&quot;); //Get the enviroment variable for the var\n        $CONNECTION_ENV_EXPLODE = explode(&quot;;&quot;,$CONNECTION_ENV);  //Split at the semi colons to seperate\n        $CONN = array(); //Make a new array\n        foreach($CONNECTION_ENV_EXPLODE as $key=&gt;$value)&#123; //Loop over the entries\n            //Get the key to be a lowercase, no spaced string that can be easily used.\n            $k = strtolower(str_replace(' ', '_', substr($value,0,strpos($value,'='))));\n            $CONN[$k] = substr($value,strpos($value,'=')+1); //Set the value to the key, and repeat\n        &#125;\n        return $CONN; \n    &#125;\n?&gt;\n</code></pre>\n<p>If you would like to see an example of the output as a PHP var dump, you can view it here:</p>\n<blockquote>\n<p><a href=\"https://brendanfuller-cis355.azurewebsites.net/db.php\">https://brendanfuller-cis355.azurewebsites.net/db.php</a></p>\n</blockquote>\n<h2 id=\"That’s-it\">That’s it!</h2>\n<p>Now there should be a fully functioning website with PHP and MySQL! Tell me what you create in the comments below!</p>\n","tags":["Azure","MySQL/MariaDB","phpMyAdmin","PHP","Web"]},{"title":"This New Blog","url":"/blog/this-new-blog/","content":"<p>This is the start to my new blog! I will probably post mostly programming projects.<br>\nI may talk about:</p>\n<ul>\n<li>Discord bots?</li>\n<li>Lots of web development!</li>\n<li>Software and related?</li>\n<li>Linux things?</li>\n<li>And probaly other things, who knows 🤷</li>\n</ul>\n<p>Anyways, I’m cutting this one short. So hopefully let’s start to a wonderful 2021!</p>\n<p><strong>Brendan</strong></p>\n","tags":["Example","JavaScript"]}]